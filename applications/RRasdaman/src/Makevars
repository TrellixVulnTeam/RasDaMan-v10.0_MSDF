# -*-Makefile-*-
# This file is part of rasdaman community.
#
# Rasdaman community is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# Rasdaman community is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with rasdaman community.  If not, see <http://www.gnu.org/licenses/>.
#
# Copyright 2003, 2004, 2005, 2006, 2007, 2008, 2009 Peter Baumann /
# rasdaman GmbH.
#
# For more information please see <http://www.rasdaman.org>
# or contact Peter Baumann via <baumann@rasdaman.com>.
#
# MAKEFILE FOR:
#   internal java library of rasdaman R package
#
##################################################################

JAVAC = javac
JAR_TOOL = jar
SPACE = $(eval) $(eval)

CD = cd
MKDIR = mkdir -p
RM = rm -rf

SRC=src
OUT=out
LIBDIR=../inst/java
JARFILE=$(LIBDIR)/RRasdaman.jar

# list of JAR libraries separated by whitespaces
libs_list=rasj.jar
# list of directories containing .java files separated by whitespaces
source_dirs_list=. rrasdaman

SRCDIRS=$(addprefix $(SRC)/, $(source_dirs_list))
BARE_CLASSES=$(patsubst $(SRC)/%.java,%.class,$(wildcard $(addsuffix /*.java, $(SRCDIRS))))
CLASSES=$(addprefix $(OUT)/, $(BARE_CLASSES))
JLIBS=$(subst $(SPACE),:,$(addprefix $(LIBDIR)/, $(libs_list)))

.PHONY: all clean compile

VPATH = $(SRCDIRS)

all: $(JARFILE)

$(OUT)/%.class: $(SRC)/%.java
	$(MKDIR) $(dir $@)
	$(JAVAC) -d $(OUT) -cp $(JLIBS) -sourcepath $(SRC) $^

compile: $(CLASSES)

$(JARFILE): compile
	$(JAR_TOOL) cf $(JARFILE) $(addprefix -C $(OUT)$(SPACE), $(BARE_CLASSES))

clean:
	$(RM) $(OUT) $(JARFILE)
